/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Group, ITEM_NOT_FOUND_MSG, MULTIPLE_INSTANCES_FOUND_MSG } from './common';
/**
 * @record
 * @template T
 */
export function IList() { }
if (false) {
    /**
     * @param {?} item
     * @return {?}
     */
    IList.prototype.add = function (item) { };
    /**
     * @param {?} items
     * @return {?}
     */
    IList.prototype.addRange = function (items) { };
    /**
     * @param {?} predicate
     * @return {?}
     */
    IList.prototype.remove = function (predicate) { };
    /**
     * @return {?}
     */
    IList.prototype.clear = function () { };
}
/**
 * @template T
 */
var /**
 * @template T
 */
List = /** @class */ (function () {
    function List(array) {
        if (array === void 0) { array = null; }
        this.list = new Array();
        if (array)
            this.list = array;
    }
    /* IList */
    /* IList */
    /**
     * @param {?} item
     * @return {?}
     */
    List.prototype.add = /* IList */
    /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.list.push(item);
    };
    /**
     * @param {?} items
     * @return {?}
     */
    List.prototype.addRange = /**
     * @param {?} items
     * @return {?}
     */
    function (items) {
        var _this = this;
        items.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return _this.add(x); }));
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.remove = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        /** @type {?} */
        var temp = new Array();
        this.list.forEach((/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            if (!predicate(element)) {
                temp.push(element);
            }
        }));
        this.list = temp;
    };
    /**
     * @return {?}
     */
    List.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.list = new Array();
    };
    /* IEnumerable */
    /* IEnumerable */
    /**
     * @return {?}
     */
    List.prototype.asEnumerable = /* IEnumerable */
    /**
     * @return {?}
     */
    function () {
        return this;
    };
    Object.defineProperty(List.prototype, "length", {
        get: /**
         * @return {?}
         */
        function () {
            return this.list.length;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} index
     * @return {?}
     */
    List.prototype.elementAt = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        try {
            return this.list[index];
        }
        catch (e) {
            return null;
        }
    };
    /**
     * @param {?=} predicate
     * @return {?}
     */
    List.prototype.any = /**
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (!predicate) {
            return this.list.length > 0;
        }
        for (var i = 0; i < this.list.length; i++) {
            if (predicate(this.list[i])) {
                return true;
            }
        }
        return false;
    };
    /**
     * @param {?=} predicate
     * @return {?}
     */
    List.prototype.all = /**
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (!predicate) {
            return this.list.length > 0;
        }
        for (var i = 0; i < this.list.length; i++) {
            if (!predicate(this.list[i])) {
                return false;
            }
        }
        return true;
    };
    /**
     * @param {?=} predicate
     * @return {?}
     */
    List.prototype.single = /**
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (predicate === void 0) { predicate = null; }
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            var item = this.singleOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[0];
    };
    /**
     * @param {?=} predicate
     * @return {?}
     */
    List.prototype.first = /**
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (predicate === void 0) { predicate = null; }
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            var item = this.firstOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[0];
    };
    /**
     * @param {?=} predicate
     * @return {?}
     */
    List.prototype.last = /**
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (predicate === void 0) { predicate = null; }
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            var item = this.lastOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[this.list.length - 1];
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.singleOrDefault = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        /** @type {?} */
        var temp = new Array();
        this.list.filter((/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            if (predicate(element)) {
                temp.push(element);
            }
        }));
        if (temp.length > 1) {
            throw MULTIPLE_INSTANCES_FOUND_MSG;
        }
        if (temp.length <= 0) {
            return null;
        }
        return temp[0];
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.firstOrDefault = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        for (var i = 0; i < this.length; i++) {
            /** @type {?} */
            var item = this.list[i];
            if (predicate(item)) {
                return item;
            }
        }
        return null;
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.lastOrDefault = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        for (var i = this.length; i >= 0; i--) {
            /** @type {?} */
            var item = this.list[i - 1];
            if (predicate(item)) {
                return item;
            }
        }
        return null;
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.where = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        /** @type {?} */
        var temp = new List();
        this.list.filter((/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            if (predicate(element)) {
                temp.add(element);
            }
        }));
        return temp;
    };
    /**
     * @template TResult
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.select = /**
     * @template TResult
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        /** @type {?} */
        var temp = new List();
        this.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return temp.add(predicate(x)); }));
        return temp;
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.forEach = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return predicate(x); }));
    };
    /**
     * @return {?}
     */
    List.prototype.toArray = /**
     * @return {?}
     */
    function () {
        return this.list;
    };
    /**
     * @template TOuter, TMatch, TResult
     * @param {?} outer
     * @param {?} conditionInner
     * @param {?} conditionOuter
     * @param {?} select
     * @param {?=} leftJoin
     * @return {?}
     */
    List.prototype.join = /**
     * @template TOuter, TMatch, TResult
     * @param {?} outer
     * @param {?} conditionInner
     * @param {?} conditionOuter
     * @param {?} select
     * @param {?=} leftJoin
     * @return {?}
     */
    function (outer, conditionInner, conditionOuter, select, leftJoin) {
        if (leftJoin === void 0) { leftJoin = false; }
        /** @type {?} */
        var resultList = new List();
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            /** @type {?} */
            var outerEntries = outer.toArray().filter((/**
             * @param {?} y
             * @return {?}
             */
            function (y) { return conditionInner(x) === conditionOuter(y); }));
            if (leftJoin && outerEntries && outerEntries.length <= 0) {
                resultList.add(select(x, null));
            }
            else {
                outerEntries.forEach((/**
                 * @param {?} z
                 * @return {?}
                 */
                function (z) { return resultList.add(select(x, z)); }));
            }
        }));
        return resultList;
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.groupBy = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        /** @type {?} */
        var groups = {};
        this.list.forEach((/**
         * @param {?} o
         * @return {?}
         */
        function (o) {
            /** @type {?} */
            var group = JSON.stringify(predicate(o));
            groups[group] = groups[group] || [];
            groups[group].push(o);
        }));
        /** @type {?} */
        var g = Object.keys(groups).map((/**
         * @param {?} group
         * @return {?}
         */
        function (group) {
            /** @type {?} */
            var a = group.substr(1, group.length - 2);
            /** @type {?} */
            var grp = new Group(a.split(','), groups[group]);
            return grp;
        }));
        return new List(g);
    };
    /**
     * @param {?} comparer
     * @return {?}
     */
    List.prototype.orderBy = /**
     * @param {?} comparer
     * @return {?}
     */
    function (comparer) {
        /** @type {?} */
        var temp = this.list.sort((/**
         * @param {?} x
         * @param {?} y
         * @return {?}
         */
        function (x, y) { return comparer.compare(x, y); }));
        return new List(temp);
    };
    /**
     * @param {?} list
     * @return {?}
     */
    List.prototype.union = /**
     * @param {?} list
     * @return {?}
     */
    function (list) {
        this.addRange(list.toArray());
        return this;
    };
    /**
     * @param {?} comparer
     * @return {?}
     */
    List.prototype.distinct = /**
     * @param {?} comparer
     * @return {?}
     */
    function (comparer) {
        /** @type {?} */
        var uniques = new List();
        this.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            uniques.forEach((/**
             * @param {?} y
             * @return {?}
             */
            function (y) {
                if (!comparer.equals(x, y)) {
                    uniques.add(x);
                }
            }));
        }));
        return uniques;
    };
    /**
     * @param {?} no
     * @return {?}
     */
    List.prototype.skip = /**
     * @param {?} no
     * @return {?}
     */
    function (no) {
        if (no > 0) {
            return new List(this.list.slice(no, this.list.length - 1));
        }
        return this;
    };
    /**
     * @param {?} no
     * @return {?}
     */
    List.prototype.take = /**
     * @param {?} no
     * @return {?}
     */
    function (no) {
        if (no > 0) {
            return new List(this.list.slice(0, no));
        }
        return this;
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.sum = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        /** @type {?} */
        var sum = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return sum = sum + predicate(x); }));
        return sum;
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.avg = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        return this.sum(predicate) / this.length;
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.min = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        /** @type {?} */
        var min = 0;
        /** @type {?} */
        var i = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            if (i == 0) {
                min = predicate(x);
            }
            else {
                /** @type {?} */
                var val = predicate(x);
                if (val < min) {
                    min = val;
                }
            }
            i++;
        }));
        return min;
    };
    /**
     * @param {?} predicate
     * @return {?}
     */
    List.prototype.max = /**
     * @param {?} predicate
     * @return {?}
     */
    function (predicate) {
        /** @type {?} */
        var max = 0;
        /** @type {?} */
        var i = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            if (i == 0) {
                max = predicate(x);
            }
            else {
                /** @type {?} */
                var val = predicate(x);
                if (val > max) {
                    max = val;
                }
            }
            i++;
        }));
        return max;
    };
    /**
     * @param {?=} predicate
     * @return {?}
     */
    List.prototype.count = /**
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (predicate === void 0) { predicate = null; }
        if (!predicate) {
            return this.length;
        }
        /** @type {?} */
        var count = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            if (predicate(x)) {
                count++;
            }
        }));
        return count;
    };
    return List;
}());
/**
 * @template T
 */
export { List };
if (false) {
    /**
     * @type {?}
     * @private
     */
    List.prototype.list;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RzLWdlbmVyaWMtY29sbGVjdGlvbnMtbGlucS8iLCJzb3VyY2VzIjpbImxpYi9saXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFjLGtCQUFrQixFQUFFLDRCQUE0QixFQUFFLE1BQU0sVUFBVSxDQUFDOzs7OztBQUUvRiwyQkFLQzs7Ozs7O0lBSkcsMENBQW9COzs7OztJQUNwQixnREFBNEI7Ozs7O0lBQzVCLGtEQUE4Qzs7OztJQUM5Qyx3Q0FBZTs7Ozs7QUFHbkI7Ozs7SUFJSSxjQUFZLEtBQXNCO1FBQXRCLHNCQUFBLEVBQUEsWUFBc0I7UUFGMUIsU0FBSSxHQUFhLElBQUksS0FBSyxFQUFLLENBQUM7UUFHcEMsSUFBSSxLQUFLO1lBQ0wsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQUVELFdBQVc7Ozs7OztJQUVYLGtCQUFHOzs7OztJQUFILFVBQUksSUFBTztRQUNQLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pCLENBQUM7Ozs7O0lBRUQsdUJBQVE7Ozs7SUFBUixVQUFTLEtBQVU7UUFBbkIsaUJBRUM7UUFERyxLQUFLLENBQUMsT0FBTzs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsS0FBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBWCxDQUFXLEVBQUMsQ0FBQztJQUNwQyxDQUFDOzs7OztJQUVELHFCQUFNOzs7O0lBQU4sVUFBTyxTQUE4Qjs7WUFDN0IsSUFBSSxHQUFHLElBQUksS0FBSyxFQUFLO1FBRXpCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTzs7OztRQUFDLFVBQUEsT0FBTztZQUNyQixJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUN2QjtnQkFDSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3RCO1FBQ0wsQ0FB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RyxDQUFDO0lBQ2YsQ0FBQzs7Ozs7SUFFRCxvQkFBSzs7OztJQUFMLFVBQU0sU0FBcUM7UUFBckMsMEJBQUEsRUFBQSxnQkFBcUM7UUFDdkMsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNaLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUN0Qjs7WUFFRyxLQUFLLEdBQVcsQ0FBQztRQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU87Ozs7UUFBQyxVQUFBLENBQUM7WUFDZixJQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDYixLQUFLLEVBQUUsQ0FBQzthQUNYO1FBQ0wsQ0FBQyxFQUFDLENBQUM7UUFFSCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRUwsV0FBQztBQUFELENBQUMsQUFsV0QsSUFrV0M7Ozs7Ozs7Ozs7SUFoV0csb0JBQXdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUVudW1lcmFibGUsIElDb21wYXJlciwgSUVxdWFsaXR5Q29tcGFyZXIgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xyXG5pbXBvcnQgeyBHcm91cCwgb2JqQ29tcGFyZSwgSVRFTV9OT1RfRk9VTkRfTVNHLCBNVUxUSVBMRV9JTlNUQU5DRVNfRk9VTkRfTVNHIH0gZnJvbSAnLi9jb21tb24nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJTGlzdDxUPiBleHRlbmRzIElFbnVtZXJhYmxlPFQ+IHtcclxuICAgIGFkZChpdGVtOiBUKSA6IHZvaWQ7XHJcbiAgICBhZGRSYW5nZShpdGVtczogVFtdKSA6IHZvaWQ7XHJcbiAgICByZW1vdmUocHJlZGljYXRlOiAoaXRlbTpUKSA9PiBib29sZWFuKSA6IHZvaWQ7XHJcbiAgICBjbGVhcigpIDogdm9pZDsgICAgXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBMaXN0PFQ+IGltcGxlbWVudHMgSUxpc3Q8VD4ge1xyXG5cclxuICAgIHByaXZhdGUgbGlzdDogQXJyYXk8VD4gPSBuZXcgQXJyYXk8VD4oKTsgICAgXHJcblxyXG4gICAgY29uc3RydWN0b3IoYXJyYXk6IEFycmF5PFQ+ID0gbnVsbCkge1xyXG4gICAgICAgIGlmIChhcnJheSlcclxuICAgICAgICAgICAgdGhpcy5saXN0ID0gYXJyYXk7XHJcbiAgICB9XHJcblxyXG4gICAgLyogSUxpc3QgKi9cclxuXHJcbiAgICBhZGQoaXRlbTogVCkgOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmxpc3QucHVzaChpdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRSYW5nZShpdGVtczogVFtdKSA6IHZvaWQge1xyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goeCA9PiB0aGlzLmFkZCh4KSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlKHByZWRpY2F0ZTogKGl0ZW06VCkgPT4gYm9vbGVhbikgOiB2b2lkIHtcclxuICAgICAgICBsZXQgdGVtcCA9IG5ldyBBcnJheTxUPigpO1xyXG5cclxuICAgICAgICB0aGlzLmxpc3QuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgaWYgKCFwcmVkaWNhdGUoZWxlbWVudCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRlbXAucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmxpc3QgPSB0ZW1wO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkgOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmxpc3QgPSBuZXcgQXJyYXk8VD4oKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBJRW51bWVyYWJsZSAqL1xyXG5cclxuICAgIGFzRW51bWVyYWJsZSgpIDogSUVudW1lcmFibGU8VD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBsZW5ndGgoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5saXN0Lmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICBlbGVtZW50QXQoaW5kZXg6IG51bWJlcikgOiBUIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0W2luZGV4XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFueShwcmVkaWNhdGU/OiAoaXRlbTogVCk9PiBib29sZWFuKSA6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmICghcHJlZGljYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3QubGVuZ3RoID4gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGk9MDsgaTx0aGlzLmxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHByZWRpY2F0ZSh0aGlzLmxpc3RbaV0pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgYWxsKHByZWRpY2F0ZT86IChpdGVtOiBUKT0+IGJvb2xlYW4pIDogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKCFwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdC5sZW5ndGggPiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5saXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICghcHJlZGljYXRlKHRoaXMubGlzdFtpXSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBzaW5nbGUocHJlZGljYXRlOiAoaXRlbTogVCk9PiBib29sZWFuID0gbnVsbCkgOiBUIHtcclxuICAgICAgICBpZiAodGhpcy5saXN0Lmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IElURU1fTk9UX0ZPVU5EX01TRztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLnNpbmdsZU9yRGVmYXVsdChwcmVkaWNhdGUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBJVEVNX05PVF9GT1VORF9NU0c7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gdGhpcy5saXN0WzBdO1xyXG4gICAgfVxyXG5cclxuICAgIGZpcnN0KHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gYm9vbGVhbiA9IG51bGwpIDogVCB7XHJcbiAgICAgICAgaWYgKHRoaXMubGlzdC5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBJVEVNX05PVF9GT1VORF9NU0c7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocHJlZGljYXRlKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5maXJzdE9yRGVmYXVsdChwcmVkaWNhdGUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBJVEVNX05PVF9GT1VORF9NU0c7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gdGhpcy5saXN0WzBdO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBsYXN0KHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gYm9vbGVhbiA9IG51bGwpIDogVCB7XHJcbiAgICAgICAgaWYgKHRoaXMubGlzdC5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBJVEVNX05PVF9GT1VORF9NU0c7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocHJlZGljYXRlKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5sYXN0T3JEZWZhdWx0KHByZWRpY2F0ZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHRocm93IElURU1fTk9UX0ZPVU5EX01TRztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5saXN0W3RoaXMubGlzdC5sZW5ndGggLSAxXTtcclxuICAgIH0gICAgXHJcblxyXG4gICAgc2luZ2xlT3JEZWZhdWx0KHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gYm9vbGVhbikgOiBUIHtcclxuICAgICAgICBsZXQgdGVtcCA9IG5ldyBBcnJheTxUPigpO1xyXG5cclxuICAgICAgICB0aGlzLmxpc3QuZmlsdGVyKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBpZiAocHJlZGljYXRlKGVsZW1lbnQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wLnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHRlbXAubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICB0aHJvdyBNVUxUSVBMRV9JTlNUQU5DRVNfRk9VTkRfTVNHO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRlbXAubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGVtcFswXTtcclxuICAgIH0gICAgXHJcblxyXG4gICAgZmlyc3RPckRlZmF1bHQocHJlZGljYXRlOiAoaXRlbTogVCk9PiBib29sZWFuKSA6IFQge1xyXG4gICAgICAgIGZvciAobGV0IGk9MDsgaTx0aGlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5saXN0W2ldO1xyXG4gICAgICAgICAgICBpZiAocHJlZGljYXRlKGl0ZW0pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgbGFzdE9yRGVmYXVsdChwcmVkaWNhdGU6IChpdGVtOiBUKT0+IGJvb2xlYW4pIDogVCB7XHJcbiAgICAgICAgZm9yIChsZXQgaT10aGlzLmxlbmd0aDsgaT49MDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5saXN0W2kgLSAxXTtcclxuICAgICAgICAgICAgaWYgKHByZWRpY2F0ZShpdGVtKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICB3aGVyZShwcmVkaWNhdGU6IChpdGVtOiBUKT0+IGJvb2xlYW4pIDogSUVudW1lcmFibGU8VD4ge1xyXG4gICAgICAgIGxldCB0ZW1wID0gbmV3IExpc3Q8VD4oKTtcclxuXHJcbiAgICAgICAgdGhpcy5saXN0LmZpbHRlcihlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgaWYgKHByZWRpY2F0ZShlbGVtZW50KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGVtcC5hZGQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRlbXA7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0PFRSZXN1bHQ+KHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gVFJlc3VsdCkgOiBJRW51bWVyYWJsZTxUUmVzdWx0PiB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSBuZXcgTGlzdDxUUmVzdWx0PigpO1xyXG5cclxuICAgICAgICB0aGlzLmZvckVhY2goeCA9PiB0ZW1wLmFkZChwcmVkaWNhdGUoeCkpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRlbXA7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yRWFjaChwcmVkaWNhdGU6IChpdGVtOiBUKT0+IHZvaWQpIDogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goeCA9PiBwcmVkaWNhdGUoeCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvQXJyYXkoKSA6IEFycmF5PFQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5saXN0O1xyXG4gICAgfVxyXG5cclxuICAgIGpvaW48VE91dGVyLCBUTWF0Y2gsIFRSZXN1bHQ+KG91dGVyOiBJRW51bWVyYWJsZTxUT3V0ZXI+LCBjb25kaXRpb25Jbm5lcjogKGl0ZW06IFQpPT4gVE1hdGNoLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uT3V0ZXI6IChpdGVtOiBUT3V0ZXIpPT4gVE1hdGNoLCBzZWxlY3Q6ICh4OiBULCB5OlRPdXRlcik9PiBUUmVzdWx0LCBsZWZ0Sm9pbjogYm9vbGVhbiA9IGZhbHNlKSA6IElFbnVtZXJhYmxlPFRSZXN1bHQ+IHtcclxuICAgICAgICBsZXQgcmVzdWx0TGlzdCA9IG5ldyBMaXN0PFRSZXN1bHQ+KCk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICBsZXQgb3V0ZXJFbnRyaWVzID0gb3V0ZXIudG9BcnJheSgpLmZpbHRlcih5ID0+IGNvbmRpdGlvbklubmVyKHgpID09PSBjb25kaXRpb25PdXRlcih5KSk7XHJcblxyXG4gICAgICAgICAgICBpZiAobGVmdEpvaW4gJiYgb3V0ZXJFbnRyaWVzICYmIG91dGVyRW50cmllcy5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5hZGQoc2VsZWN0KHgsIG51bGwpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG91dGVyRW50cmllcy5mb3JFYWNoKHogPT4gcmVzdWx0TGlzdC5hZGQoc2VsZWN0KHgsIHopKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0TGlzdDtcclxuICAgIH1cclxuXHJcbiAgICBncm91cEJ5KHByZWRpY2F0ZTogKGl0ZW06IFQpID0+IEFycmF5PGFueT4pIDogSUVudW1lcmFibGU8R3JvdXA8VD4+IHtcclxuICAgICAgICBsZXQgZ3JvdXBzID0ge307XHJcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goZnVuY3Rpb24gKG8pIHtcclxuICAgICAgICAgIHZhciBncm91cCA9IEpTT04uc3RyaW5naWZ5KHByZWRpY2F0ZShvKSk7XHJcbiAgICAgICAgICBncm91cHNbZ3JvdXBdID0gZ3JvdXBzW2dyb3VwXSB8fCBbXTtcclxuICAgICAgICAgIGdyb3Vwc1tncm91cF0ucHVzaChvKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgZyA9IE9iamVjdC5rZXlzKGdyb3VwcykubWFwKGZ1bmN0aW9uIChncm91cCkgeyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IGEgPSBncm91cC5zdWJzdHIoMSwgZ3JvdXAubGVuZ3RoIC0gMik7XHJcblxyXG4gICAgICAgICAgICBsZXQgZ3JwPSBuZXcgR3JvdXA8VD4oYS5zcGxpdCgnLCcpLCBncm91cHNbZ3JvdXBdKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBncnA7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgTGlzdDxHcm91cDxUPj4oZyk7ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBvcmRlckJ5KGNvbXBhcmVyOiBJQ29tcGFyZXI8VD4pIDogSUVudW1lcmFibGU8VD4ge1xyXG4gICAgICAgIGxldCB0ZW1wID0gdGhpcy5saXN0LnNvcnQoKHgseSkgPT4gY29tcGFyZXIuY29tcGFyZSh4LCB5KSk7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgTGlzdDxUPih0ZW1wKTtcclxuICAgIH1cclxuXHJcbiAgICB1bmlvbihsaXN0OiBJRW51bWVyYWJsZTxUPikgOiBJRW51bWVyYWJsZTxUPiB7XHJcbiAgICAgICAgdGhpcy5hZGRSYW5nZShsaXN0LnRvQXJyYXkoKSk7XHJcblxyXG4gICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBkaXN0aW5jdChjb21wYXJlcjogSUVxdWFsaXR5Q29tcGFyZXI8VD4pIDogSUVudW1lcmFibGU8VD4ge1xyXG4gICAgICAgIGxldCB1bmlxdWVzID0gbmV3IExpc3Q8VD4oKTtcclxuICAgICAgICB0aGlzLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgIHVuaXF1ZXMuZm9yRWFjaCh5ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghY29tcGFyZXIuZXF1YWxzKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlcy5hZGQoeCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdW5pcXVlcztcclxuICAgIH1cclxuXHJcbiAgICBza2lwKG5vOiBudW1iZXIpIDogSUVudW1lcmFibGU8VD4ge1xyXG4gICAgICAgIGlmIChubyA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0KHRoaXMubGlzdC5zbGljZShubywgdGhpcy5saXN0Lmxlbmd0aCAtIDEpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgdGFrZShubzogbnVtYmVyKSA6IElFbnVtZXJhYmxlPFQ+IHtcclxuICAgICAgICBpZiAobm8gPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdCh0aGlzLmxpc3Quc2xpY2UoMCwgbm8pKTtcclxuICAgICAgICB9ICAgICAgICBcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgc3VtKHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gbnVtYmVyKSA6IG51bWJlciB7XHJcbiAgICAgICAgbGV0IHN1bTogbnVtYmVyID0gMDtcclxuICAgICAgICB0aGlzLmxpc3QuZm9yRWFjaCh4ID0+IHN1bSA9IHN1bSArIHByZWRpY2F0ZSh4KSk7XHJcblxyXG4gICAgICAgIHJldHVybiBzdW07XHJcbiAgICB9XHJcblxyXG4gICAgYXZnKHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gbnVtYmVyKSA6IG51bWJlciB7ICAgICAgICBcclxuICAgICAgICByZXR1cm4gdGhpcy5zdW0ocHJlZGljYXRlKSAvIHRoaXMubGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIG1pbihwcmVkaWNhdGU6IChpdGVtOiBUKT0+IG51bWJlcikgOiBudW1iZXIge1xyXG4gICAgICAgIGxldCBtaW46IG51bWJlciA9IDA7XHJcbiAgICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKHggPT4gXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoaSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBtaW4gPSBwcmVkaWNhdGUoeCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsID0gcHJlZGljYXRlKHgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbCA8IG1pbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG1pbiA9IHZhbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpKys7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBtaW47XHJcbiAgICB9XHJcbiAgICBcclxuICAgIG1heChwcmVkaWNhdGU6IChpdGVtOiBUKT0+IG51bWJlcikgOiBudW1iZXIge1xyXG4gICAgICAgIGxldCBtYXg6IG51bWJlciA9IDA7XHJcbiAgICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKHggPT4gXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoaSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBtYXggPSBwcmVkaWNhdGUoeCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsID0gcHJlZGljYXRlKHgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbCA+IG1heCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heCA9IHZhbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpKys7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBtYXg7XHJcbiAgICB9ICAgIFxyXG4gICAgXHJcbiAgICBjb3VudChwcmVkaWNhdGU6IChpdGVtOiBUKT0+IGJvb2xlYW4gPSBudWxsKSA6IG51bWJlciB7XHJcbiAgICAgICAgaWYgKCFwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGNvdW50OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICBpZihwcmVkaWNhdGUoeCkpIHtcclxuICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvdW50O1xyXG4gICAgfVxyXG5cclxufSJdfQ==