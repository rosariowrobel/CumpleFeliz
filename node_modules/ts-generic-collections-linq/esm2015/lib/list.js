/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Group, ITEM_NOT_FOUND_MSG, MULTIPLE_INSTANCES_FOUND_MSG } from './common';
/**
 * @record
 * @template T
 */
export function IList() { }
if (false) {
    /**
     * @param {?} item
     * @return {?}
     */
    IList.prototype.add = function (item) { };
    /**
     * @param {?} items
     * @return {?}
     */
    IList.prototype.addRange = function (items) { };
    /**
     * @param {?} predicate
     * @return {?}
     */
    IList.prototype.remove = function (predicate) { };
    /**
     * @return {?}
     */
    IList.prototype.clear = function () { };
}
/**
 * @template T
 */
export class List {
    /**
     * @param {?=} array
     */
    constructor(array = null) {
        this.list = new Array();
        if (array)
            this.list = array;
    }
    /* IList */
    /**
     * @param {?} item
     * @return {?}
     */
    add(item) {
        this.list.push(item);
    }
    /**
     * @param {?} items
     * @return {?}
     */
    addRange(items) {
        items.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => this.add(x)));
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    remove(predicate) {
        /** @type {?} */
        let temp = new Array();
        this.list.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            if (!predicate(element)) {
                temp.push(element);
            }
        }));
        this.list = temp;
    }
    /**
     * @return {?}
     */
    clear() {
        this.list = new Array();
    }
    /* IEnumerable */
    /**
     * @return {?}
     */
    asEnumerable() {
        return this;
    }
    /**
     * @return {?}
     */
    get length() {
        return this.list.length;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    elementAt(index) {
        try {
            return this.list[index];
        }
        catch (e) {
            return null;
        }
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    any(predicate) {
        if (!predicate) {
            return this.list.length > 0;
        }
        for (let i = 0; i < this.list.length; i++) {
            if (predicate(this.list[i])) {
                return true;
            }
        }
        return false;
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    all(predicate) {
        if (!predicate) {
            return this.list.length > 0;
        }
        for (let i = 0; i < this.list.length; i++) {
            if (!predicate(this.list[i])) {
                return false;
            }
        }
        return true;
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    single(predicate = null) {
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            let item = this.singleOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[0];
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    first(predicate = null) {
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            let item = this.firstOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[0];
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    last(predicate = null) {
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            let item = this.lastOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[this.list.length - 1];
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    singleOrDefault(predicate) {
        /** @type {?} */
        let temp = new Array();
        this.list.filter((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            if (predicate(element)) {
                temp.push(element);
            }
        }));
        if (temp.length > 1) {
            throw MULTIPLE_INSTANCES_FOUND_MSG;
        }
        if (temp.length <= 0) {
            return null;
        }
        return temp[0];
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    firstOrDefault(predicate) {
        for (let i = 0; i < this.length; i++) {
            /** @type {?} */
            let item = this.list[i];
            if (predicate(item)) {
                return item;
            }
        }
        return null;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    lastOrDefault(predicate) {
        for (let i = this.length; i >= 0; i--) {
            /** @type {?} */
            let item = this.list[i - 1];
            if (predicate(item)) {
                return item;
            }
        }
        return null;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    where(predicate) {
        /** @type {?} */
        let temp = new List();
        this.list.filter((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            if (predicate(element)) {
                temp.add(element);
            }
        }));
        return temp;
    }
    /**
     * @template TResult
     * @param {?} predicate
     * @return {?}
     */
    select(predicate) {
        /** @type {?} */
        let temp = new List();
        this.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => temp.add(predicate(x))));
        return temp;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    forEach(predicate) {
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => predicate(x)));
    }
    /**
     * @return {?}
     */
    toArray() {
        return this.list;
    }
    /**
     * @template TOuter, TMatch, TResult
     * @param {?} outer
     * @param {?} conditionInner
     * @param {?} conditionOuter
     * @param {?} select
     * @param {?=} leftJoin
     * @return {?}
     */
    join(outer, conditionInner, conditionOuter, select, leftJoin = false) {
        /** @type {?} */
        let resultList = new List();
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            /** @type {?} */
            let outerEntries = outer.toArray().filter((/**
             * @param {?} y
             * @return {?}
             */
            y => conditionInner(x) === conditionOuter(y)));
            if (leftJoin && outerEntries && outerEntries.length <= 0) {
                resultList.add(select(x, null));
            }
            else {
                outerEntries.forEach((/**
                 * @param {?} z
                 * @return {?}
                 */
                z => resultList.add(select(x, z))));
            }
        }));
        return resultList;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    groupBy(predicate) {
        /** @type {?} */
        let groups = {};
        this.list.forEach((/**
         * @param {?} o
         * @return {?}
         */
        function (o) {
            /** @type {?} */
            var group = JSON.stringify(predicate(o));
            groups[group] = groups[group] || [];
            groups[group].push(o);
        }));
        /** @type {?} */
        let g = Object.keys(groups).map((/**
         * @param {?} group
         * @return {?}
         */
        function (group) {
            /** @type {?} */
            let a = group.substr(1, group.length - 2);
            /** @type {?} */
            let grp = new Group(a.split(','), groups[group]);
            return grp;
        }));
        return new List(g);
    }
    /**
     * @param {?} comparer
     * @return {?}
     */
    orderBy(comparer) {
        /** @type {?} */
        let temp = this.list.sort((/**
         * @param {?} x
         * @param {?} y
         * @return {?}
         */
        (x, y) => comparer.compare(x, y)));
        return new List(temp);
    }
    /**
     * @param {?} list
     * @return {?}
     */
    union(list) {
        this.addRange(list.toArray());
        return this;
    }
    /**
     * @param {?} comparer
     * @return {?}
     */
    distinct(comparer) {
        /** @type {?} */
        let uniques = new List();
        this.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            uniques.forEach((/**
             * @param {?} y
             * @return {?}
             */
            y => {
                if (!comparer.equals(x, y)) {
                    uniques.add(x);
                }
            }));
        }));
        return uniques;
    }
    /**
     * @param {?} no
     * @return {?}
     */
    skip(no) {
        if (no > 0) {
            return new List(this.list.slice(no, this.list.length - 1));
        }
        return this;
    }
    /**
     * @param {?} no
     * @return {?}
     */
    take(no) {
        if (no > 0) {
            return new List(this.list.slice(0, no));
        }
        return this;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    sum(predicate) {
        /** @type {?} */
        let sum = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => sum = sum + predicate(x)));
        return sum;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    avg(predicate) {
        return this.sum(predicate) / this.length;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    min(predicate) {
        /** @type {?} */
        let min = 0;
        /** @type {?} */
        let i = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (i == 0) {
                min = predicate(x);
            }
            else {
                /** @type {?} */
                let val = predicate(x);
                if (val < min) {
                    min = val;
                }
            }
            i++;
        }));
        return min;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    max(predicate) {
        /** @type {?} */
        let max = 0;
        /** @type {?} */
        let i = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (i == 0) {
                max = predicate(x);
            }
            else {
                /** @type {?} */
                let val = predicate(x);
                if (val > max) {
                    max = val;
                }
            }
            i++;
        }));
        return max;
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    count(predicate = null) {
        if (!predicate) {
            return this.length;
        }
        /** @type {?} */
        let count = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (predicate(x)) {
                count++;
            }
        }));
        return count;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    List.prototype.list;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RzLWdlbmVyaWMtY29sbGVjdGlvbnMtbGlucS8iLCJzb3VyY2VzIjpbImxpYi9saXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFjLGtCQUFrQixFQUFFLDRCQUE0QixFQUFFLE1BQU0sVUFBVSxDQUFDOzs7OztBQUUvRiwyQkFLQzs7Ozs7O0lBSkcsMENBQW9COzs7OztJQUNwQixnREFBNEI7Ozs7O0lBQzVCLGtEQUE4Qzs7OztJQUM5Qyx3Q0FBZTs7Ozs7QUFHbkIsTUFBTSxPQUFPLElBQUk7Ozs7SUFJYixZQUFZLFFBQWtCLElBQUk7UUFGMUIsU0FBSSxHQUFhLElBQUksS0FBSyxFQUFLLENBQUM7UUFHcEMsSUFBSSxLQUFLO1lBQ0wsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQzs7Ozs7O0lBSUQsR0FBRyxDQUFDLElBQU87UUFDUCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN6QixDQUFDOzs7OztJQUVELFFBQVEsQ0FBQyxLQUFVO1FBQ2YsS0FBSyxDQUFDLE9BQU87Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztJQUNwQyxDQUFDOzs7OztJQUVELE1BQU0sQ0FBQyxTQUE4Qjs7WUFDN0IsSUFBSSxHQUFHLElBQUksS0FBSyxFQUFLO1FBRXpCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTzs7OztRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3hCLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQ3ZCO2dCQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDdEI7UUFDTCxDQUFDLEVBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3JCLENBQUM7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O29CQUNYLEdBQUcsR0FBRyxHQUFHLENBQUM7aUJBQ2I7YUFDSjtZQUNELENBQUMsRUFBRSxDQUFDO1FBQ1IsQ0FBQyxFQUFDLENBQUM7UUFFSCxPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUM7Ozs7O0lBRUQsR0FBRyxDQUFDLFNBQTZCOztZQUN6QixHQUFHLEdBQVcsQ0FBQzs7WUFDZixDQUFDLEdBQUcsQ0FBQztRQUNULElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFO1lBRWxCLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDUixHQUFHLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3RCO2lCQUNJOztvQkFDRyxHQUFHLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDdEIsSUFBSSxHQUFHLEdBQUcsR0FBRyxFQUFFO29CQUNYLEdBQUcsR0FBRyxHQUFHLENBQUM7aUJBQ2I7YUFDSjtZQUNELENBQUMsRUFBRSxDQUFDO1FBQ1IsQ0FBQyxFQUFDLENBQUM7UUFFSCxPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUM7Ozs7O0lBRUQsS0FBSyxDQUFDLFlBQWlDLElBQUk7UUFDdkMsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNaLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUN0Qjs7WUFFRyxLQUFLLEdBQVcsQ0FBQztRQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU87Ozs7UUFBQyxDQUFDLENBQUMsRUFBRTtZQUNsQixJQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDYixLQUFLLEVBQUUsQ0FBQzthQUNYO1FBQ0wsQ0FBQyxFQUFDLENBQUM7UUFFSCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0NBRUo7Ozs7OztJQWhXRyxvQkFBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJRW51bWVyYWJsZSwgSUNvbXBhcmVyLCBJRXF1YWxpdHlDb21wYXJlciB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XHJcbmltcG9ydCB7IEdyb3VwLCBvYmpDb21wYXJlLCBJVEVNX05PVF9GT1VORF9NU0csIE1VTFRJUExFX0lOU1RBTkNFU19GT1VORF9NU0cgfSBmcm9tICcuL2NvbW1vbic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElMaXN0PFQ+IGV4dGVuZHMgSUVudW1lcmFibGU8VD4ge1xyXG4gICAgYWRkKGl0ZW06IFQpIDogdm9pZDtcclxuICAgIGFkZFJhbmdlKGl0ZW1zOiBUW10pIDogdm9pZDtcclxuICAgIHJlbW92ZShwcmVkaWNhdGU6IChpdGVtOlQpID0+IGJvb2xlYW4pIDogdm9pZDtcclxuICAgIGNsZWFyKCkgOiB2b2lkOyAgICBcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIExpc3Q8VD4gaW1wbGVtZW50cyBJTGlzdDxUPiB7XHJcblxyXG4gICAgcHJpdmF0ZSBsaXN0OiBBcnJheTxUPiA9IG5ldyBBcnJheTxUPigpOyAgICBcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcnJheTogQXJyYXk8VD4gPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKGFycmF5KVxyXG4gICAgICAgICAgICB0aGlzLmxpc3QgPSBhcnJheTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBJTGlzdCAqL1xyXG5cclxuICAgIGFkZChpdGVtOiBUKSA6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubGlzdC5wdXNoKGl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFJhbmdlKGl0ZW1zOiBUW10pIDogdm9pZCB7XHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaCh4ID0+IHRoaXMuYWRkKHgpKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmUocHJlZGljYXRlOiAoaXRlbTpUKSA9PiBib29sZWFuKSA6IHZvaWQge1xyXG4gICAgICAgIGxldCB0ZW1wID0gbmV3IEFycmF5PFQ+KCk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXByZWRpY2F0ZShlbGVtZW50KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGVtcC5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdCA9IHRlbXA7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXIoKSA6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubGlzdCA9IG5ldyBBcnJheTxUPigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIElFbnVtZXJhYmxlICovXHJcblxyXG4gICAgYXNFbnVtZXJhYmxlKCkgOiBJRW51bWVyYWJsZTxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGxlbmd0aCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3QubGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIGVsZW1lbnRBdChpbmRleDogbnVtYmVyKSA6IFQge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3RbaW5kZXhdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYW55KHByZWRpY2F0ZT86IChpdGVtOiBUKT0+IGJvb2xlYW4pIDogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKCFwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdC5sZW5ndGggPiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChsZXQgaT0wOyBpPHRoaXMubGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAocHJlZGljYXRlKHRoaXMubGlzdFtpXSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBhbGwocHJlZGljYXRlPzogKGl0ZW06IFQpPT4gYm9vbGVhbikgOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIXByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0Lmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAobGV0IGk9MDsgaTx0aGlzLmxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKCFwcmVkaWNhdGUodGhpcy5saXN0W2ldKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHNpbmdsZShwcmVkaWNhdGU6IChpdGVtOiBUKT0+IGJvb2xlYW4gPSBudWxsKSA6IFQge1xyXG4gICAgICAgIGlmICh0aGlzLmxpc3QubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgSVRFTV9OT1RfRk9VTkRfTVNHO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuc2luZ2xlT3JEZWZhdWx0KHByZWRpY2F0ZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHRocm93IElURU1fTk9UX0ZPVU5EX01TRztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RbMF07XHJcbiAgICB9XHJcblxyXG4gICAgZmlyc3QocHJlZGljYXRlOiAoaXRlbTogVCk9PiBib29sZWFuID0gbnVsbCkgOiBUIHtcclxuICAgICAgICBpZiAodGhpcy5saXN0Lmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IElURU1fTk9UX0ZPVU5EX01TRztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmZpcnN0T3JEZWZhdWx0KHByZWRpY2F0ZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHRocm93IElURU1fTk9UX0ZPVU5EX01TRztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RbMF07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGxhc3QocHJlZGljYXRlOiAoaXRlbTogVCk9PiBib29sZWFuID0gbnVsbCkgOiBUIHtcclxuICAgICAgICBpZiAodGhpcy5saXN0Lmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IElURU1fTk9UX0ZPVU5EX01TRztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmxhc3RPckRlZmF1bHQocHJlZGljYXRlKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgSVRFTV9OT1RfRk9VTkRfTVNHO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RbdGhpcy5saXN0Lmxlbmd0aCAtIDFdO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICBzaW5nbGVPckRlZmF1bHQocHJlZGljYXRlOiAoaXRlbTogVCk9PiBib29sZWFuKSA6IFQge1xyXG4gICAgICAgIGxldCB0ZW1wID0gbmV3IEFycmF5PFQ+KCk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdC5maWx0ZXIoZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoZWxlbWVudCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRlbXAucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodGVtcC5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgIHRocm93IE1VTFRJUExFX0lOU1RBTkNFU19GT1VORF9NU0c7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGVtcC5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0ZW1wWzBdO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICBmaXJzdE9yRGVmYXVsdChwcmVkaWNhdGU6IChpdGVtOiBUKT0+IGJvb2xlYW4pIDogVCB7XHJcbiAgICAgICAgZm9yIChsZXQgaT0wOyBpPHRoaXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmxpc3RbaV07XHJcbiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoaXRlbSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBsYXN0T3JEZWZhdWx0KHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gYm9vbGVhbikgOiBUIHtcclxuICAgICAgICBmb3IgKGxldCBpPXRoaXMubGVuZ3RoOyBpPj0wOyBpLS0pIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmxpc3RbaSAtIDFdO1xyXG4gICAgICAgICAgICBpZiAocHJlZGljYXRlKGl0ZW0pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9ICAgIFxyXG5cclxuICAgIHdoZXJlKHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gYm9vbGVhbikgOiBJRW51bWVyYWJsZTxUPiB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSBuZXcgTGlzdDxUPigpO1xyXG5cclxuICAgICAgICB0aGlzLmxpc3QuZmlsdGVyKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBpZiAocHJlZGljYXRlKGVsZW1lbnQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wLmFkZChlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdGVtcDtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3Q8VFJlc3VsdD4ocHJlZGljYXRlOiAoaXRlbTogVCk9PiBUUmVzdWx0KSA6IElFbnVtZXJhYmxlPFRSZXN1bHQ+IHtcclxuICAgICAgICBsZXQgdGVtcCA9IG5ldyBMaXN0PFRSZXN1bHQ+KCk7XHJcblxyXG4gICAgICAgIHRoaXMuZm9yRWFjaCh4ID0+IHRlbXAuYWRkKHByZWRpY2F0ZSh4KSkpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGVtcDtcclxuICAgIH1cclxuXHJcbiAgICBmb3JFYWNoKHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gdm9pZCkgOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmxpc3QuZm9yRWFjaCh4ID0+IHByZWRpY2F0ZSh4KSk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9BcnJheSgpIDogQXJyYXk8VD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgam9pbjxUT3V0ZXIsIFRNYXRjaCwgVFJlc3VsdD4ob3V0ZXI6IElFbnVtZXJhYmxlPFRPdXRlcj4sIGNvbmRpdGlvbklubmVyOiAoaXRlbTogVCk9PiBUTWF0Y2gsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25PdXRlcjogKGl0ZW06IFRPdXRlcik9PiBUTWF0Y2gsIHNlbGVjdDogKHg6IFQsIHk6VE91dGVyKT0+IFRSZXN1bHQsIGxlZnRKb2luOiBib29sZWFuID0gZmFsc2UpIDogSUVudW1lcmFibGU8VFJlc3VsdD4ge1xyXG4gICAgICAgIGxldCByZXN1bHRMaXN0ID0gbmV3IExpc3Q8VFJlc3VsdD4oKTtcclxuXHJcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgIGxldCBvdXRlckVudHJpZXMgPSBvdXRlci50b0FycmF5KCkuZmlsdGVyKHkgPT4gY29uZGl0aW9uSW5uZXIoeCkgPT09IGNvbmRpdGlvbk91dGVyKHkpKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChsZWZ0Sm9pbiAmJiBvdXRlckVudHJpZXMgJiYgb3V0ZXJFbnRyaWVzLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0LmFkZChzZWxlY3QoeCwgbnVsbCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb3V0ZXJFbnRyaWVzLmZvckVhY2goeiA9PiByZXN1bHRMaXN0LmFkZChzZWxlY3QoeCwgeikpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHRMaXN0O1xyXG4gICAgfVxyXG5cclxuICAgIGdyb3VwQnkocHJlZGljYXRlOiAoaXRlbTogVCkgPT4gQXJyYXk8YW55PikgOiBJRW51bWVyYWJsZTxHcm91cDxUPj4ge1xyXG4gICAgICAgIGxldCBncm91cHMgPSB7fTtcclxuICAgICAgICB0aGlzLmxpc3QuZm9yRWFjaChmdW5jdGlvbiAobykge1xyXG4gICAgICAgICAgdmFyIGdyb3VwID0gSlNPTi5zdHJpbmdpZnkocHJlZGljYXRlKG8pKTtcclxuICAgICAgICAgIGdyb3Vwc1tncm91cF0gPSBncm91cHNbZ3JvdXBdIHx8IFtdO1xyXG4gICAgICAgICAgZ3JvdXBzW2dyb3VwXS5wdXNoKG8pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGxldCBnID0gT2JqZWN0LmtleXMoZ3JvdXBzKS5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBsZXQgYSA9IGdyb3VwLnN1YnN0cigxLCBncm91cC5sZW5ndGggLSAyKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBncnA9IG5ldyBHcm91cDxUPihhLnNwbGl0KCcsJyksIGdyb3Vwc1tncm91cF0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGdycDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBMaXN0PEdyb3VwPFQ+PihnKTsgICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIG9yZGVyQnkoY29tcGFyZXI6IElDb21wYXJlcjxUPikgOiBJRW51bWVyYWJsZTxUPiB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSB0aGlzLmxpc3Quc29ydCgoeCx5KSA9PiBjb21wYXJlci5jb21wYXJlKHgsIHkpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBMaXN0PFQ+KHRlbXApO1xyXG4gICAgfVxyXG5cclxuICAgIHVuaW9uKGxpc3Q6IElFbnVtZXJhYmxlPFQ+KSA6IElFbnVtZXJhYmxlPFQ+IHtcclxuICAgICAgICB0aGlzLmFkZFJhbmdlKGxpc3QudG9BcnJheSgpKTtcclxuXHJcbiAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIGRpc3RpbmN0KGNvbXBhcmVyOiBJRXF1YWxpdHlDb21wYXJlcjxUPikgOiBJRW51bWVyYWJsZTxUPiB7XHJcbiAgICAgICAgbGV0IHVuaXF1ZXMgPSBuZXcgTGlzdDxUPigpO1xyXG4gICAgICAgIHRoaXMuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgdW5pcXVlcy5mb3JFYWNoKHkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb21wYXJlci5lcXVhbHMoeCwgeSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB1bmlxdWVzLmFkZCh4KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB1bmlxdWVzO1xyXG4gICAgfVxyXG5cclxuICAgIHNraXAobm86IG51bWJlcikgOiBJRW51bWVyYWJsZTxUPiB7XHJcbiAgICAgICAgaWYgKG5vID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IExpc3QodGhpcy5saXN0LnNsaWNlKG5vLCB0aGlzLmxpc3QubGVuZ3RoIC0gMSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICB0YWtlKG5vOiBudW1iZXIpIDogSUVudW1lcmFibGU8VD4ge1xyXG4gICAgICAgIGlmIChubyA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0KHRoaXMubGlzdC5zbGljZSgwLCBubykpO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBzdW0ocHJlZGljYXRlOiAoaXRlbTogVCk9PiBudW1iZXIpIDogbnVtYmVyIHtcclxuICAgICAgICBsZXQgc3VtOiBudW1iZXIgPSAwO1xyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKHggPT4gc3VtID0gc3VtICsgcHJlZGljYXRlKHgpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHN1bTtcclxuICAgIH1cclxuXHJcbiAgICBhdmcocHJlZGljYXRlOiAoaXRlbTogVCk9PiBudW1iZXIpIDogbnVtYmVyIHsgICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0aGlzLnN1bShwcmVkaWNhdGUpIC8gdGhpcy5sZW5ndGg7XHJcbiAgICB9XHJcblxyXG4gICAgbWluKHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gbnVtYmVyKSA6IG51bWJlciB7XHJcbiAgICAgICAgbGV0IG1pbjogbnVtYmVyID0gMDtcclxuICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goeCA9PiBcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChpID09IDApIHtcclxuICAgICAgICAgICAgICAgIG1pbiA9IHByZWRpY2F0ZSh4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCB2YWwgPSBwcmVkaWNhdGUoeCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsIDwgbWluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWluID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1pbjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgbWF4KHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gbnVtYmVyKSA6IG51bWJlciB7XHJcbiAgICAgICAgbGV0IG1heDogbnVtYmVyID0gMDtcclxuICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goeCA9PiBcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChpID09IDApIHtcclxuICAgICAgICAgICAgICAgIG1heCA9IHByZWRpY2F0ZSh4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCB2YWwgPSBwcmVkaWNhdGUoeCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsID4gbWF4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4ID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1heDtcclxuICAgIH0gICAgXHJcbiAgICBcclxuICAgIGNvdW50KHByZWRpY2F0ZTogKGl0ZW06IFQpPT4gYm9vbGVhbiA9IG51bGwpIDogbnVtYmVyIHtcclxuICAgICAgICBpZiAoIXByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY291bnQ6IG51bWJlciA9IDA7XHJcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgIGlmKHByZWRpY2F0ZSh4KSkge1xyXG4gICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gY291bnQ7XHJcbiAgICB9XHJcblxyXG59Il19