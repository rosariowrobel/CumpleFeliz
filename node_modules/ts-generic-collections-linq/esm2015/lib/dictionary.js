/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { List } from './list';
import { Group, objCompare, ITEM_NOT_FOUND_MSG, MULTIPLE_INSTANCES_FOUND_MSG } from './common';
/**
 * @record
 * @template TKey, TValue
 */
export function IDictionary() { }
if (false) {
    /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    IDictionary.prototype.add = function (key, value) { };
    /**
     * @param {?} items
     * @return {?}
     */
    IDictionary.prototype.addRange = function (items) { };
    /**
     * @param {?} predicate
     * @return {?}
     */
    IDictionary.prototype.remove = function (predicate) { };
    /**
     * @return {?}
     */
    IDictionary.prototype.clear = function () { };
    /**
     * @param {?} key
     * @return {?}
     */
    IDictionary.prototype.containsKey = function (key) { };
    /**
     * @param {?} value
     * @return {?}
     */
    IDictionary.prototype.containsValue = function (value) { };
    /**
     * @param {?} key
     * @return {?}
     */
    IDictionary.prototype.tryGetValue = function (key) { };
}
/**
 * @template TKey, TValue
 */
export class Dictionary {
    /**
     * @param {?=} list
     */
    constructor(list = null) {
        this.list = new Array();
        if (list) {
            this.list = list;
        }
    }
    /* IList */
    /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    add(key, value) {
        /** @type {?} */
        let pair = new KeyValuePair(key, value);
        if (this.containsKey(key)) {
            throw "Duplicate key. Cannot add.";
        }
        this.list.push(pair);
    }
    /**
     * @param {?} items
     * @return {?}
     */
    addRange(items) {
        items.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => this.add(x.key, x.value)));
    }
    /**
     * @return {?}
     */
    clear() {
        this.list = new Array();
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    remove(predicate) {
        /** @type {?} */
        let temp = new Array();
        this.list.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            if (!predicate(element)) {
                temp.push(element);
            }
        }));
        this.list = temp;
    }
    /**
     * @param {?} key
     * @return {?}
     */
    containsKey(key) {
        return this.any((/**
         * @param {?} x
         * @return {?}
         */
        x => objCompare(x.key, key)));
    }
    /**
     * @param {?} value
     * @return {?}
     */
    containsValue(value) {
        return this.any((/**
         * @param {?} x
         * @return {?}
         */
        x => objCompare(x.value, value)));
    }
    /**
     * @param {?} key
     * @return {?}
     */
    tryGetValue(key) {
        /** @type {?} */
        let item = this.singleOrDefault((/**
         * @param {?} x
         * @return {?}
         */
        x => objCompare(x.key, key)));
        if (item) {
            return item.value;
        }
        return null;
    }
    /* IEnumerable */
    /**
     * @return {?}
     */
    asEnumerable() {
        return this;
    }
    /**
     * @return {?}
     */
    get length() {
        return this.list.length;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    elementAt(index) {
        try {
            return this.list[index];
        }
        catch (e) {
            return null;
        }
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    any(predicate) {
        if (!predicate) {
            return this.list.length > 0;
        }
        for (let i = 0; i < this.list.length; i++) {
            if (predicate(this.list[i])) {
                return true;
            }
        }
        return false;
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    all(predicate) {
        if (!predicate) {
            return this.list.length > 0;
        }
        for (let i = 0; i < this.list.length; i++) {
            if (!predicate(this.list[i])) {
                return false;
            }
        }
        return true;
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    single(predicate = null) {
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            let item = this.singleOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[0];
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    first(predicate = null) {
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            let item = this.firstOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[0];
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    last(predicate) {
        if (this.list.length <= 0) {
            throw ITEM_NOT_FOUND_MSG;
        }
        if (predicate) {
            /** @type {?} */
            let item = this.lastOrDefault(predicate);
            if (!item) {
                throw ITEM_NOT_FOUND_MSG;
            }
            return item;
        }
        return this.list[this.list.length - 1];
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    singleOrDefault(predicate) {
        /** @type {?} */
        let temp = new Array();
        this.list.filter((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            if (predicate(element)) {
                temp.push(element);
            }
        }));
        if (temp.length > 1) {
            throw MULTIPLE_INSTANCES_FOUND_MSG;
        }
        if (temp.length <= 0) {
            return null;
        }
        return temp[0];
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    firstOrDefault(predicate) {
        for (let i = 0; i < this.length; i++) {
            /** @type {?} */
            let item = this.list[i];
            if (predicate(item)) {
                return item;
            }
        }
        return null;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    lastOrDefault(predicate) {
        for (let i = this.length; i >= 0; i--) {
            /** @type {?} */
            let item = this.list[i - 1];
            if (predicate(item)) {
                return item;
            }
        }
        return null;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    where(predicate) {
        /** @type {?} */
        let temp = new Dictionary();
        this.list.filter((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            if (predicate(element)) {
                temp.add(element.key, element.value);
            }
        }));
        return temp;
    }
    /**
     * @template TResult
     * @param {?} predicate
     * @return {?}
     */
    select(predicate) {
        /** @type {?} */
        let temp = new List();
        this.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => temp.add(predicate(x))));
        return temp;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    forEach(predicate) {
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => predicate(x)));
    }
    /**
     * @return {?}
     */
    toArray() {
        return this.list;
    }
    /**
     * @template TOuter, TMatch, TResult
     * @param {?} outer
     * @param {?} conditionInner
     * @param {?} conditionOuter
     * @param {?} select
     * @param {?=} leftJoin
     * @return {?}
     */
    join(outer, conditionInner, conditionOuter, select, leftJoin = false) {
        /** @type {?} */
        let resultList = new List();
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            /** @type {?} */
            let outerEntries = outer.toArray().filter((/**
             * @param {?} y
             * @return {?}
             */
            y => conditionInner(x) === conditionOuter(y)));
            if (leftJoin && outerEntries && outerEntries.length <= 0) {
                resultList.add(select(x, null));
            }
            else {
                outerEntries.forEach((/**
                 * @param {?} z
                 * @return {?}
                 */
                z => resultList.add(select(x, z))));
            }
        }));
        return resultList;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    groupBy(predicate) {
        /** @type {?} */
        let groups = {};
        this.list.forEach((/**
         * @param {?} o
         * @return {?}
         */
        function (o) {
            /** @type {?} */
            var group = JSON.stringify(predicate(o));
            groups[group] = groups[group] || [];
            groups[group].push(o);
        }));
        /** @type {?} */
        let g = Object.keys(groups).map((/**
         * @param {?} group
         * @return {?}
         */
        function (group) {
            /** @type {?} */
            let a = group.substr(1, group.length - 2);
            /** @type {?} */
            let grp = new Group(a.split(','), groups[group]);
            return grp;
        }));
        return new List(g);
    }
    /**
     * @param {?} comparer
     * @return {?}
     */
    orderBy(comparer) {
        /** @type {?} */
        let temp = this.list.sort((/**
         * @param {?} x
         * @param {?} y
         * @return {?}
         */
        (x, y) => comparer.compare(x, y)));
        return new List(temp);
    }
    /**
     * @param {?} comparer
     * @return {?}
     */
    distinct(comparer) {
        /** @type {?} */
        let uniques = new List();
        this.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            uniques.forEach((/**
             * @param {?} y
             * @return {?}
             */
            y => {
                if (!comparer.equals(x, y)) {
                    uniques.add(x);
                }
            }));
        }));
        return uniques;
    }
    /**
     * @param {?} list
     * @return {?}
     */
    union(list) {
        this.addRange(list.toArray());
        return this;
    }
    /**
     * @param {?} no
     * @return {?}
     */
    skip(no) {
        if (no > 0) {
            return new Dictionary(this.list.slice(no, this.list.length - 1));
        }
        return this;
    }
    /**
     * @param {?} no
     * @return {?}
     */
    take(no) {
        if (no > 0) {
            return new Dictionary(this.list.slice(0, no));
        }
        return this;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    sum(predicate) {
        /** @type {?} */
        let sum = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => sum = sum + predicate(x)));
        return sum;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    avg(predicate) {
        return this.sum(predicate) / this.length;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    min(predicate) {
        /** @type {?} */
        let min = 0;
        /** @type {?} */
        let i = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (i == 0) {
                min = predicate(x);
            }
            else {
                /** @type {?} */
                let val = predicate(x);
                if (val < min) {
                    min = val;
                }
            }
            i++;
        }));
        return min;
    }
    /**
     * @param {?} predicate
     * @return {?}
     */
    max(predicate) {
        /** @type {?} */
        let max = 0;
        /** @type {?} */
        let i = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (i == 0) {
                max = predicate(x);
            }
            else {
                /** @type {?} */
                let val = predicate(x);
                if (val > max) {
                    max = val;
                }
            }
            i++;
        }));
        return max;
    }
    /**
     * @param {?=} predicate
     * @return {?}
     */
    count(predicate = null) {
        if (!predicate) {
            return this.length;
        }
        /** @type {?} */
        let count = 0;
        this.list.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (predicate(x)) {
                count++;
            }
        }));
        return count;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    Dictionary.prototype.list;
}
/**
 * @template TKey, TValue
 */
export class KeyValuePair {
    /**
     * @param {?} key
     * @param {?} value
     */
    constructor(key, value) {
        this.key = key;
        this.value = value;
    }
}
if (false) {
    /** @type {?} */
    KeyValuePair.prototype.key;
    /** @type {?} */
    KeyValuePair.prototype.value;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGljdGlvbmFyeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RzLWdlbmVyaWMtY29sbGVjdGlvbnMtbGlucS8iLCJzb3VyY2VzIjpbImxpYi9kaWN0aW9uYXJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzlCLE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLGtCQUFrQixFQUFFLDRCQUE0QixFQUFFLE1BQU0sVUFBVSxDQUFDOzs7OztBQUUvRixpQ0FTQzs7Ozs7OztJQVJHLHNEQUFxQzs7Ozs7SUFDckMsc0RBQXFEOzs7OztJQUNyRCx3REFBdUU7Ozs7SUFDdkUsOENBQWU7Ozs7O0lBRWYsdURBQWlDOzs7OztJQUNqQywyREFBdUM7Ozs7O0lBQ3ZDLHVEQUFnQzs7Ozs7QUFHcEMsTUFBTSxPQUFPLFVBQVU7Ozs7SUFJbkIsWUFBWSxPQUEwQyxJQUFJO1FBRmxELFNBQUksR0FBc0MsSUFBSSxLQUFLLEVBQThCLENBQUM7UUFHdEYsSUFBSSxJQUFJLEVBQUU7WUFDTixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztTQUNwQjtJQUNMLENBQUM7Ozs7Ozs7SUFJRCxHQUFHLENBQUMsR0FBUyxFQUFFLEtBQWE7O1lBQ3BCLElBQUksR0FBRyxJQUFJLFlBQVksQ0FBZSxHQUFHLEVBQUUsS0FBSyxDQUFDO1FBRXJELElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN2QixNQUFNLDRCQUE0QixDQUFBO1NBQ3JDO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekIsQ0FBQzs7Ozs7SUFFRCxRQUFRLENBQUMsS0FBbUM7UUFDeEMsS0FBSyxDQUFDLE9BQU87Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMs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IjpbImltcG9ydCB7IElFbnVtZXJhYmxlLCBJQ29tcGFyZXIsIElFcXVhbGl0eUNvbXBhcmVyIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcclxuaW1wb3J0IHsgTGlzdCB9IGZyb20gJy4vbGlzdCc7XHJcbmltcG9ydCB7IEdyb3VwLCBvYmpDb21wYXJlLCBJVEVNX05PVF9GT1VORF9NU0csIE1VTFRJUExFX0lOU1RBTkNFU19GT1VORF9NU0cgfSBmcm9tICcuL2NvbW1vbic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElEaWN0aW9uYXJ5PFRLZXksIFRWYWx1ZT4gZXh0ZW5kcyBJRW51bWVyYWJsZTxLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPj4ge1xyXG4gICAgYWRkKGtleTogVEtleSwgdmFsdWU6IFRWYWx1ZSkgOiB2b2lkO1xyXG4gICAgYWRkUmFuZ2UoaXRlbXM6IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+W10pIDogdm9pZDtcclxuICAgIHJlbW92ZShwcmVkaWNhdGU6IChpdGVtOktleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+KSA9PiBib29sZWFuKSA6IHZvaWQ7XHJcbiAgICBjbGVhcigpIDogdm9pZDtcclxuXHJcbiAgICBjb250YWluc0tleShrZXk6IFRLZXkpIDogYm9vbGVhbjtcclxuICAgIGNvbnRhaW5zVmFsdWUodmFsdWU6IFRWYWx1ZSkgOiBib29sZWFuO1xyXG4gICAgdHJ5R2V0VmFsdWUoa2V5OiBUS2V5KSA6IFRWYWx1ZTtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIERpY3Rpb25hcnk8VEtleSwgVFZhbHVlPiBpbXBsZW1lbnRzIElEaWN0aW9uYXJ5PFRLZXksIFRWYWx1ZT5cclxue1xyXG4gICAgcHJpdmF0ZSBsaXN0OiBBcnJheTxLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPj4gPSBuZXcgQXJyYXk8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+KCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IobGlzdDogQXJyYXk8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+ID0gbnVsbCkge1xyXG4gICAgICAgIGlmIChsaXN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMubGlzdCA9IGxpc3Q7XHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgLyogSUxpc3QgKi9cclxuXHJcbiAgICBhZGQoa2V5OiBUS2V5LCB2YWx1ZTogVFZhbHVlKSA6IHZvaWQge1xyXG4gICAgICAgIGxldCBwYWlyID0gbmV3IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+KGtleSwgdmFsdWUpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jb250YWluc0tleShrZXkpKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwiRHVwbGljYXRlIGtleS4gQ2Fubm90IGFkZC5cIlxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5saXN0LnB1c2gocGFpcik7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkUmFuZ2UoaXRlbXM6IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+W10pIDogdm9pZCB7XHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaCh4ID0+IHRoaXMuYWRkKHgua2V5LCB4LnZhbHVlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXIoKSA6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubGlzdCA9IG5ldyBBcnJheTxLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPj4oKTtcclxuICAgIH0gICAgXHJcblxyXG4gICAgcmVtb3ZlKHByZWRpY2F0ZTogKGl0ZW06S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4pID0+IGJvb2xlYW4pIDogdm9pZCB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSBuZXcgQXJyYXk8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+KCk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXByZWRpY2F0ZShlbGVtZW50KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGVtcC5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdCA9IHRlbXA7XHJcbiAgICB9ICAgIFxyXG5cclxuICAgIGNvbnRhaW5zS2V5KGtleTogVEtleSkgOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hbnkoeCA9PiBvYmpDb21wYXJlKHgua2V5LCBrZXkpKTtcclxuICAgIH1cclxuXHJcbiAgICBjb250YWluc1ZhbHVlKHZhbHVlOiBUVmFsdWUpIDogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYW55KHggPT4gb2JqQ29tcGFyZSh4LnZhbHVlLCB2YWx1ZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeUdldFZhbHVlKGtleTogVEtleSkgOiBUVmFsdWUge1xyXG4gICAgICAgIGxldCBpdGVtID0gdGhpcy5zaW5nbGVPckRlZmF1bHQoeCA9PiBvYmpDb21wYXJlKHgua2V5LCBrZXkpKTtcclxuXHJcbiAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvKiBJRW51bWVyYWJsZSAqL1xyXG5cclxuICAgIGFzRW51bWVyYWJsZSgpIDogSUVudW1lcmFibGU8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+IHtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbGVuZ3RoKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdC5sZW5ndGg7XHJcbiAgICB9XHJcblxyXG4gICAgZWxlbWVudEF0KGluZGV4OiBudW1iZXIpIDogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3RbaW5kZXhdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9ICAgIFxyXG5cclxuICAgIGFueShwcmVkaWNhdGU/OiAoaXRlbTogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4pPT4gYm9vbGVhbikgOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIXByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0Lmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5saXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUodGhpcy5saXN0W2ldKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGFsbChwcmVkaWNhdGU/OiAoaXRlbTogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4pPT4gYm9vbGVhbikgOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIXByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0Lmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAobGV0IGk9MDsgaTx0aGlzLmxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKCFwcmVkaWNhdGUodGhpcy5saXN0W2ldKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICBzaW5nbGUocHJlZGljYXRlOiAoaXRlbTogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4pPT4gYm9vbGVhbiA9IG51bGwpIDogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmxpc3QubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgSVRFTV9OT1RfRk9VTkRfTVNHO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuc2luZ2xlT3JEZWZhdWx0KHByZWRpY2F0ZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHRocm93IElURU1fTk9UX0ZPVU5EX01TRztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RbMF07XHJcbiAgICB9XHJcblxyXG4gICAgZmlyc3QocHJlZGljYXRlOiAoaXRlbTogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4pPT4gYm9vbGVhbiA9IG51bGwpIDogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmxpc3QubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgSVRFTV9OT1RfRk9VTkRfTVNHO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuZmlyc3RPckRlZmF1bHQocHJlZGljYXRlKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgSVRFTV9OT1RfRk9VTkRfTVNHO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdFswXTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgbGFzdChwcmVkaWNhdGU6IChpdGVtOiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPik9PiBib29sZWFuKSA6IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+IHtcclxuICAgICAgICBpZiAodGhpcy5saXN0Lmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IElURU1fTk9UX0ZPVU5EX01TRztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmxhc3RPckRlZmF1bHQocHJlZGljYXRlKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgSVRFTV9OT1RfRk9VTkRfTVNHO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RbdGhpcy5saXN0Lmxlbmd0aCAtIDFdO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICBzaW5nbGVPckRlZmF1bHQocHJlZGljYXRlOiAoaXRlbTogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4pPT4gYm9vbGVhbikgOiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPiB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSBuZXcgQXJyYXk8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+KCk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdC5maWx0ZXIoZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoZWxlbWVudCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRlbXAucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodGVtcC5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgIHRocm93IE1VTFRJUExFX0lOU1RBTkNFU19GT1VORF9NU0c7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGVtcC5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0ZW1wWzBdO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICBmaXJzdE9yRGVmYXVsdChwcmVkaWNhdGU6IChpdGVtOiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPik9PiBib29sZWFuKSA6IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+IHsgICAgICAgIFxyXG4gICAgICAgIGZvciAobGV0IGk9MDsgaTx0aGlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5saXN0W2ldO1xyXG4gICAgICAgICAgICBpZiAocHJlZGljYXRlKGl0ZW0pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgbGFzdE9yRGVmYXVsdChwcmVkaWNhdGU6IChpdGVtOiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPik9PiBib29sZWFuKSA6IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+IHtcclxuICAgICAgICBmb3IgKGxldCBpPXRoaXMubGVuZ3RoOyBpPj0wOyBpLS0pIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmxpc3RbaSAtIDFdO1xyXG4gICAgICAgICAgICBpZiAocHJlZGljYXRlKGl0ZW0pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9ICAgIFxyXG5cclxuICAgIHdoZXJlKHByZWRpY2F0ZTogKGl0ZW06IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+KT0+IGJvb2xlYW4pIDogSURpY3Rpb25hcnk8VEtleSwgVFZhbHVlPiB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSBuZXcgRGljdGlvbmFyeTxUS2V5LCBUVmFsdWU+KCk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdC5maWx0ZXIoZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoZWxlbWVudCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRlbXAuYWRkKGVsZW1lbnQua2V5LCBlbGVtZW50LnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdGVtcDtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3Q8VFJlc3VsdD4ocHJlZGljYXRlOiAoaXRlbTogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4pPT4gVFJlc3VsdCkgOiBJRW51bWVyYWJsZTxUUmVzdWx0PiB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSBuZXcgTGlzdDxUUmVzdWx0PigpO1xyXG5cclxuICAgICAgICB0aGlzLmZvckVhY2goeCA9PiB0ZW1wLmFkZChwcmVkaWNhdGUoeCkpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRlbXA7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yRWFjaChwcmVkaWNhdGU6IChpdGVtOiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPik9PiB2b2lkKSA6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKHggPT4gcHJlZGljYXRlKHgpKTtcclxuICAgIH1cclxuXHJcbiAgICB0b0FycmF5KCkgOiBBcnJheTxLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPj4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgam9pbjxUT3V0ZXIsIFRNYXRjaCwgVFJlc3VsdD4ob3V0ZXI6IElFbnVtZXJhYmxlPFRPdXRlcj4sIGNvbmRpdGlvbklubmVyOiAoaXRlbTogS2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4pPT4gVE1hdGNoLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uT3V0ZXI6IChpdGVtOiBUT3V0ZXIpPT4gVE1hdGNoLCBzZWxlY3Q6ICh4OiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPiwgeTpUT3V0ZXIpPT4gVFJlc3VsdCwgbGVmdEpvaW46IGJvb2xlYW4gPSBmYWxzZSkgOiBJRW51bWVyYWJsZTxUUmVzdWx0PiB7XHJcbiAgICAgICAgbGV0IHJlc3VsdExpc3QgPSBuZXcgTGlzdDxUUmVzdWx0PigpO1xyXG5cclxuICAgICAgICB0aGlzLmxpc3QuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgbGV0IG91dGVyRW50cmllcyA9IG91dGVyLnRvQXJyYXkoKS5maWx0ZXIoeSA9PiBjb25kaXRpb25Jbm5lcih4KSA9PT0gY29uZGl0aW9uT3V0ZXIoeSkpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxlZnRKb2luICYmIG91dGVyRW50cmllcyAmJiBvdXRlckVudHJpZXMubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QuYWRkKHNlbGVjdCh4LCBudWxsKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvdXRlckVudHJpZXMuZm9yRWFjaCh6ID0+IHJlc3VsdExpc3QuYWRkKHNlbGVjdCh4LCB6KSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdExpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgZ3JvdXBCeShwcmVkaWNhdGU6IChpdGVtOiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPikgPT4gQXJyYXk8YW55PikgOiBJRW51bWVyYWJsZTxHcm91cDxLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPj4+IHtcclxuICAgICAgICBsZXQgZ3JvdXBzID0ge307XHJcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goZnVuY3Rpb24gKG8pIHtcclxuICAgICAgICAgIHZhciBncm91cCA9IEpTT04uc3RyaW5naWZ5KHByZWRpY2F0ZShvKSk7XHJcbiAgICAgICAgICBncm91cHNbZ3JvdXBdID0gZ3JvdXBzW2dyb3VwXSB8fCBbXTtcclxuICAgICAgICAgIGdyb3Vwc1tncm91cF0ucHVzaChvKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgZyA9IE9iamVjdC5rZXlzKGdyb3VwcykubWFwKGZ1bmN0aW9uIChncm91cCkgeyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IGEgPSBncm91cC5zdWJzdHIoMSwgZ3JvdXAubGVuZ3RoIC0gMik7XHJcblxyXG4gICAgICAgICAgICBsZXQgZ3JwPSBuZXcgR3JvdXA8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+KGEuc3BsaXQoJywnKSwgZ3JvdXBzW2dyb3VwXSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZ3JwO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IExpc3Q8R3JvdXA8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+PihnKTsgICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIG9yZGVyQnkoY29tcGFyZXI6IElDb21wYXJlcjxLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPj4pIDogSUVudW1lcmFibGU8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+IHtcclxuICAgICAgICBsZXQgdGVtcCA9IHRoaXMubGlzdC5zb3J0KCh4LHkpID0+IGNvbXBhcmVyLmNvbXBhcmUoeCwgeSkpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IExpc3Q8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+KHRlbXApO1xyXG4gICAgfVxyXG5cclxuICAgIGRpc3RpbmN0KGNvbXBhcmVyOiBJRXF1YWxpdHlDb21wYXJlcjxLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPj4pIDogSUVudW1lcmFibGU8S2V5VmFsdWVQYWlyPFRLZXksIFRWYWx1ZT4+IHtcclxuICAgICAgICBsZXQgdW5pcXVlcyA9IG5ldyBMaXN0PEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+PigpO1xyXG4gICAgICAgIHRoaXMuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgdW5pcXVlcy5mb3JFYWNoKHkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb21wYXJlci5lcXVhbHMoeCwgeSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB1bmlxdWVzLmFkZCh4KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB1bmlxdWVzO1xyXG4gICAgfVxyXG5cclxuICAgIHVuaW9uKGxpc3Q6IElFbnVtZXJhYmxlPEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+PikgOiBJRGljdGlvbmFyeTxUS2V5LCBUVmFsdWU+IHtcclxuICAgICAgICAgdGhpcy5hZGRSYW5nZShsaXN0LnRvQXJyYXkoKSk7XHJcblxyXG4gICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH0gICAgXHJcblxyXG4gICAgc2tpcChubzogbnVtYmVyKSA6IElEaWN0aW9uYXJ5PFRLZXksIFRWYWx1ZT4ge1xyXG4gICAgICAgIGlmIChubyA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5KHRoaXMubGlzdC5zbGljZShubywgdGhpcy5saXN0Lmxlbmd0aCAtIDEpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgdGFrZShubzogbnVtYmVyKSA6IElEaWN0aW9uYXJ5PFRLZXksIFRWYWx1ZT4ge1xyXG4gICAgICAgIGlmIChubyA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5KHRoaXMubGlzdC5zbGljZSgwLCBubykpO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH0gICAgXHJcblxyXG4gICAgc3VtKHByZWRpY2F0ZTogKGl0ZW06IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+KT0+IG51bWJlcikgOiBudW1iZXIge1xyXG4gICAgICAgIGxldCBzdW06IG51bWJlciA9IDA7XHJcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goeCA9PiBzdW0gPSBzdW0gKyBwcmVkaWNhdGUoeCkpO1xyXG5cclxuICAgICAgICByZXR1cm4gc3VtO1xyXG4gICAgfVxyXG5cclxuICAgIGF2ZyhwcmVkaWNhdGU6IChpdGVtOiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPik9PiBudW1iZXIpIDogbnVtYmVyIHsgICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0aGlzLnN1bShwcmVkaWNhdGUpIC8gdGhpcy5sZW5ndGg7XHJcbiAgICB9XHJcblxyXG4gICAgbWluKHByZWRpY2F0ZTogKGl0ZW06IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+KT0+IG51bWJlcikgOiBudW1iZXIge1xyXG4gICAgICAgIGxldCBtaW46IG51bWJlciA9IDA7XHJcbiAgICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKHggPT4gXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoaSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBtaW4gPSBwcmVkaWNhdGUoeCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsID0gcHJlZGljYXRlKHgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbCA8IG1pbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG1pbiA9IHZhbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpKys7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBtaW47XHJcbiAgICB9XHJcbiAgICBcclxuICAgIG1heChwcmVkaWNhdGU6IChpdGVtOiBLZXlWYWx1ZVBhaXI8VEtleSwgVFZhbHVlPik9PiBudW1iZXIpIDogbnVtYmVyIHtcclxuICAgICAgICBsZXQgbWF4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICB0aGlzLmxpc3QuZm9yRWFjaCh4ID0+IFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGkgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgbWF4ID0gcHJlZGljYXRlKHgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbCA9IHByZWRpY2F0ZSh4KTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWwgPiBtYXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXggPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbWF4O1xyXG4gICAgfVxyXG5cclxuICAgIGNvdW50KHByZWRpY2F0ZTogKGl0ZW06IEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+KT0+IGJvb2xlYW4gPSBudWxsKSA6IG51bWJlciB7XHJcbiAgICAgICAgaWYgKCFwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGNvdW50OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICBpZihwcmVkaWNhdGUoeCkpIHtcclxuICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvdW50O1xyXG4gICAgfSAgICBcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEtleVZhbHVlUGFpcjxUS2V5LCBUVmFsdWU+IHtcclxuICAgIGtleTogVEtleTtcclxuICAgIHZhbHVlOiBUVmFsdWU7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioa2V5OiBUS2V5LCB2YWx1ZTogVFZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5rZXkgPSBrZXk7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgfVxyXG59Il19